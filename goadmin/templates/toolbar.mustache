<<define "toolbar">>
  <template id="toolbar">
    <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '2160853304235441',
        cookie     : true,
        xfbml      : true,
        version    : 'v3.1'
      });

      FB.AppEvents.logPageView(); 
      FB.getLoginStatus(function(response) {
        console.log("getLoginstatus called");
        //console.log(response.authResponse.userID);
        if(response.status==='connected'){
          console.log("Already connected,check if Musician exists");
          var http = new XMLHttpRequest();
          var url = "/api/profileCheck/"+response.authResponse.userID;
          $.getJSON(url, function(data) {

            if (data.success) {
              console.log("This means Musician exists")
              console.log("Disappear the FB login button")
              document.getElementById("loginDiv").style.display='none';
              document.getElementById("signupDiv").style.display='none';
              document.getElementById("logout").style.display='block';
              if('<<.CurrentPage>>'==='index'){
                console.log("This is the index page");
                window.location = "/profile/"+response.authResponse.userID;
              }

            }else {
              console.log("Musician is logged out, but is connected");
            }
          });


        } else{
          console.log("Not Connected yet lets make them login");
          document.getElementById("logout").style.display='none';
          if('<<.CurrentPage>>' != 'index'){
            window.location="/";
          }
        }       
      });

    };

    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v3.1&appId=891327687616015&autoLogAppEvents=1';
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

//This is the same functionality as above, but for the ones who will click on the FB button
function checkLoginState() {
  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });
}

function statusChangeCallback(response){

  console.log(response.status);
  if(response.status==='connected'){
    console.log("Already connected,check if Musician exists");
    var http = new XMLHttpRequest();
    var url = "/api/profileCheck/"+response.authResponse.userID;
    $.getJSON(url, function(data) {

      if (data.success) {
        console.log("This means Musician exists")
        console.log("Disappear the FB login button")
        document.getElementById("loginDiv").style.display='none';
        document.getElementById("signupDiv").style.display='none';
        document.getElementById("logout").style.display='block';
        if('<<.CurrentPage>>'==='index'){
          console.log("This is the index page");
          window.location = "/profile/"+response.authResponse.userID;
        }else{
                        //Now we have to check if someone else is using somebody elses data
                        if('<<.UserID>>'===response.authResponse.userID){

                        }else{
                          window.location = "/profile/"+response.authResponse.userID;
                        }
                      }

                    }else {
                      console.log("Musician is logged out, but is connected");
                      window.location = "/signup?id="+response.authResponse.userID+"&fbToken="+response.authResponse.accessToken;
                    }
                  });


  } else{
          // if('<<.CurrentPage>>'!= 'index'){
          //   window.location="/";
          // }
        }
      }

      function logout(){
        console.log("logout called");
        FB.getLoginStatus(function(response) {
          console.log(response.authResponse.userID);
          var http = new XMLHttpRequest();
          var url = "/api/profileLogout/"+response.authResponse.userID;
          $.getJSON(url, function(data) {

            if (data.success) {

              document.getElementById("loginDiv").style.display='block';
              document.getElementById("signupDiv").style.display='block';
              document.getElementById("logout").style.display='none';

              console.log("This is the index page");
              window.location = "/";


            }
          });

        });

      }


    </script>   

    <script>
      $('#exampleModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var recipient = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  modal.find('.modal-title').text('New message to ' + recipient)
  modal.find('.modal-body input').val(recipient)
})
</script> 
<div id="app" class="md-theme-default">
  <a class="skip-link screen-reader-text" href="#content">Skip to content</a>

  <header id="masthead" class="site-header" role="banner" style="background:black;">
    <div class="site-header-wrapper">
      <div id="site-menu" class="site-menu">
        <nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
          <div class="menu-main-menu-container">
            <ul id="menu-main-menu" class="primary-menu">
              <li id="menu-item-659" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-659 current_page_item"><a href="https://bon.pe/blog/bon-seed-round-sep18">Home</a></li>
              <li id="menu-item-234" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-234"><a href="https://bon.pe/about">How It Works</a></li>
              <li id="menu-item-658" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-658"><a href="http://angel.co/bon-/jobs">Blog</a></li>
              <li id="menu-item-235" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-235"><a href="https://bon.pe/contact">Contact Us</a></li>
              
            </ul>
          </div>         
        </nav><!-- .main-navigation -->
      </div><!-- .site-menu -->
      <div class="site-branding1">
        <a href="/" class="custom-logo-link" rel="home" itemprop="url"><img width="240" height="77" src="<<.StaticHost>>/images/logo/LOGOv2.png" class="custom-logo" alt="" itemprop="logo" /></a>
        <p class="site-title"><a href="/home" rel="home">Prove Your Worth</a></p>
        <p class="site-description">RubberBand, Prove Your Worth</p>
      </div>
        <!-- .site-branding -->

      <div >
        <nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
            <div class="menu-main-menu-container">
              <ul id="menu-main-menu" class="primary-menu">
                <li>
              <div id="loginDiv" style="float:left;height:100%;">
                <button class="Rounded-Rectangle-8-copy" data-toggle="modal" data-target="#exampleModal">
                  Login
                </button>

              </div>
            </li>
            <li>
              <div id="signupDiv">
                <button class="Rounded-Rectangle-8" data-toggle="modal" data-target="#exampleModal">
                  Signup

                </button>

              </div>
            </li>
            <li>
              <div id="logout" onclick="logout()" style="display:none">
                <button class="Rounded-Rectangle-8" data-toggle="modal" data-target="#exampleModal">
                  Logout

                </button>

              </div>
            </li>
          </ul>
            </div>          
          </nav>  
        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Signup or Login using Facebook</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div>

                  <div class="fb-login-button" data-max-rows="1" data-size="large" data-button-type="login_with" data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="true" scope="public_profile,email"
                  onlogin="checkLoginState();"></div>
                </div>

              </div>
      <!-- <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Send message</button>
      </div> -->
    </div>
  </div>
</div>
<button id="menu-toggle" class="menu-toggle">Menu</button>

</div><!-- .site-header-wrapper -->
</header><!-- #masthead -->
</div>
<style>
.PYW {
  background-image: url("<<.StaticHost>>/images/assets/background_landing1.png");
  background-size:     cover;                      /* <------ */
  background-repeat:   no-repeat;
  background-position: center center; 

} 
</style>
</template>
<<template "toolbarjs" . >>
  <<end>>